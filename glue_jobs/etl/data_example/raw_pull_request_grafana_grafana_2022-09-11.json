[{"url": "https://api.github.com/repos/grafana/grafana/issues/51724", "repository_url": "https://api.github.com/repos/grafana/grafana", "labels_url": "https://api.github.com/repos/grafana/grafana/issues/51724/labels{/name}", "comments_url": "https://api.github.com/repos/grafana/grafana/issues/51724/comments", "events_url": "https://api.github.com/repos/grafana/grafana/issues/51724/events", "html_url": "https://github.com/grafana/grafana/pull/51724", "id": 1293641693, "node_id": "PR_kwDOAOaWjc460qVL", "number": 51724, "title": "Docs: Add AWS SNS notifier support", "user": {"login": "Birds", "id": 31365193, "node_id": "MDQ6VXNlcjMxMzY1MTkz", "avatar_url": "https://avatars.githubusercontent.com/u/31365193?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Birds", "html_url": "https://github.com/Birds", "followers_url": "https://api.github.com/users/Birds/followers", "following_url": "https://api.github.com/users/Birds/following{/other_user}", "gists_url": "https://api.github.com/users/Birds/gists{/gist_id}", "starred_url": "https://api.github.com/users/Birds/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Birds/subscriptions", "organizations_url": "https://api.github.com/users/Birds/orgs", "repos_url": "https://api.github.com/users/Birds/repos", "events_url": "https://api.github.com/users/Birds/events{/privacy}", "received_events_url": "https://api.github.com/users/Birds/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 102367297, "node_id": "MDU6TGFiZWwxMDIzNjcyOTc=", "url": "https://api.github.com/repos/grafana/grafana/labels/type/docs", "name": "type/docs", "color": "dddddd", "default": false, "description": ""}, {"id": 227867844, "node_id": "MDU6TGFiZWwyMjc4Njc4NDQ=", "url": "https://api.github.com/repos/grafana/grafana/labels/area/alerting", "name": "area/alerting", "color": "c5def5", "default": false, "description": "Grafana Alerting"}, {"id": 798215910, "node_id": "MDU6TGFiZWw3OTgyMTU5MTA=", "url": "https://api.github.com/repos/grafana/grafana/labels/area/backend", "name": "area/backend", "color": "c7def8", "default": false, "description": ""}, {"id": 1071019213, "node_id": "MDU6TGFiZWwxMDcxMDE5MjEz", "url": "https://api.github.com/repos/grafana/grafana/labels/area/frontend", "name": "area/frontend", "color": "c7def8", "default": false, "description": ""}, {"id": 1170217328, "node_id": "MDU6TGFiZWwxMTcwMjE3MzI4", "url": "https://api.github.com/repos/grafana/grafana/labels/add%20to%20changelog", "name": "add to changelog", "color": "b8f785", "default": false, "description": ""}, {"id": 1649642747, "node_id": "MDU6TGFiZWwxNjQ5NjQyNzQ3", "url": "https://api.github.com/repos/grafana/grafana/labels/pr/external", "name": "pr/external", "color": "2fc4a4", "default": false, "description": "This PR is from external contributor"}, {"id": 2827823071, "node_id": "MDU6TGFiZWwyODI3ODIzMDcx", "url": "https://api.github.com/repos/grafana/grafana/labels/area/backend/db/migration", "name": "area/backend/db/migration", "color": "c7def8", "default": false, "description": ""}, {"id": 3719969061, "node_id": "LA_kwDOAOaWjc7dujkl", "url": "https://api.github.com/repos/grafana/grafana/labels/no-backport", "name": "no-backport", "color": "b60205", "default": false, "description": "Skip backport of PR"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/grafana/grafana/milestones/326", "html_url": "https://github.com/grafana/grafana/milestone/326", "labels_url": "https://api.github.com/repos/grafana/grafana/milestones/326/labels", "id": 8237227, "node_id": "MI_kwDOAOaWjc4AfbCr", "number": 326, "title": "9.2.0", "description": null, "creator": {"login": "armandgrillet", "id": 2117580, "node_id": "MDQ6VXNlcjIxMTc1ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/2117580?v=4", "gravatar_id": "", "url": "https://api.github.com/users/armandgrillet", "html_url": "https://github.com/armandgrillet", "followers_url": "https://api.github.com/users/armandgrillet/followers", "following_url": "https://api.github.com/users/armandgrillet/following{/other_user}", "gists_url": "https://api.github.com/users/armandgrillet/gists{/gist_id}", "starred_url": "https://api.github.com/users/armandgrillet/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/armandgrillet/subscriptions", "organizations_url": "https://api.github.com/users/armandgrillet/orgs", "repos_url": "https://api.github.com/users/armandgrillet/repos", "events_url": "https://api.github.com/users/armandgrillet/events{/privacy}", "received_events_url": "https://api.github.com/users/armandgrillet/received_events", "type": "User", "site_admin": false}, "open_issues": 131, "closed_issues": 697, "state": "open", "created_at": "2022-07-26T09:36:47Z", "updated_at": "2022-09-18T14:02:47Z", "due_on": null, "closed_at": null}, "comments": 9, "created_at": "2022-07-04T23:54:06Z", "updated_at": "2022-09-11T10:06:24Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/grafana/grafana/pulls/51724", "html_url": "https://github.com/grafana/grafana/pull/51724", "diff_url": "https://github.com/grafana/grafana/pull/51724.diff", "patch_url": "https://github.com/grafana/grafana/pull/51724.patch", "merged_at": null}, "body": "**What this PR does / why we need it**:\r\n\r\n* Addition of AWS SNS as a notification channel option for unified and legacy grafana alerts.\r\n* Bug fix for the legacy and unified grafana alerts ShowWhen property.\r\n    * The ShowWhen property used in Grafana's alerting component hides certain input fields unless a specified condition is met. This feature is not working properly. Specifically, any field using this property remains hidden, regardless of the specified condition being met.\r\n\r\n## Legacy Alerting SNS Notification Channel\r\n![image](https://user-images.githubusercontent.com/31365193/179860882-dab76a24-025d-4b80-aad0-6be84c7461e3.png)\r\n\r\n### Message Formats\r\nAlert tags support has been added through the introduction of message formats. There are two message formats which is `Text` and `JSON`. Tagging is supported with either message format.\r\n\r\nThe `JSON` format outputs human readable formatted JSON. Tags can be now be included in the SNS notifier's JSON messages.\r\n> {\r\n    \"body\": \"alert text body\",\r\n    \"state\": \"ok\"\r\n}\r\n\r\nThe `Text` format is largely similar to the existing message body format. It adds the alert status above the text message body.\r\n> State: ok\r\nalert text body\r\n\r\n![Screen Shot 2022-03-22 at 3 53 29 PM](https://user-images.githubusercontent.com/31365193/159589488-0e7142df-d048-4e9d-b6ee-a2421500666f.png)\r\n\r\n### Tagging Support\r\nTagging is supported with either the `Text` or `JSON` message format. The _Include all tags in the message_ option must be selected to include tags in the message.\r\n\r\n![Screen Shot 2022-03-22 at 3 54 41 PM](https://user-images.githubusercontent.com/31365193/159589630-860b8a2f-33c9-43fb-a5d3-ed19d504a8fc.png)\r\n\r\nThe order in which the tags are listed is not guaranteed in either message format.\r\n\r\n#### Tagging Examples\r\nThe examples below will be constructed with the alert's message body presumed to contain the text 'alert text body' and alert status 'ok'. The following alert tags will be set, listed below formatted as `key:value`:\r\n- `sns_data:1192872`\r\n- `severity:low`\r\n\r\n**Example for the _Text_ format with all tags included**\r\n```\r\nstate:ok\r\nbody:alert text body\r\nsns_data:1192872\r\nseverity:low\r\n```\r\n\r\n**Example for the _JSON_ format with all tags included**\r\n```\r\n{\r\n    \"body\": \"alert text body\",\r\n    \"sns_data\": \"1192872\",\r\n    \"severity\": \"low\",\r\n    \"state\": \"ok\"\r\n}\r\n```\r\n\r\n## Grafana Alerting SNS Contact Point\r\n![Screen Shot 2022-07-19 at 3 47 07 PM](https://user-images.githubusercontent.com/31365193/179861122-7ff5c75f-2b75-4dfb-9e68-99d51f177f14.png)\r\n\r\n### The new `Body` message format\r\n\r\nUnified alerting allows the SNS notifier to provide a significant amount of data to the customer. After discussions with Helen, we felt it was better to have the default experience show all available alerting data to the customer.\r\n\r\nHowever, we also wanted to make sure the SNS notifier allowed customers to leverage the [message templating](https://grafana.com/docs/grafana/latest/alerting/contact-points/message-templating/) feature to specify their own notification data and format for alerts. This message format does that by providing a blank slate, where only the text/message template entered into the `Text Body` field is included in the SNS message.\r\n\r\n#### `Include all tags in the message` checkbox has been removed\r\n\r\nIn unified alerting, there still exists \"labels\" (essentially legacy alerting tags) and \"annotations\" (tags, except the value is a large text body). However, _labels_ and _annotations_ now only represent a small fraction of the alerting data a customer can receive, and the functionality of this option is covered by the new `Include only the text body in messages` checkbox.\r\n\r\n#### Introduction of the optional `Subject` and `Text Body` fields\r\n\r\nThese fields were introduced to allow customers to set their own subject fields and add data tied specifically to a contact point. These fields support message templating.\r\n\r\n\r\n### Message Examples\r\nAvailable message formats are shown below:\r\n![image](https://user-images.githubusercontent.com/31365193/176328745-b53c2980-367f-41a4-8cc4-cbe619918aea.png)\r\n\r\n**Example for the _Text_ format**\r\n```\r\n**Resolved**\r\n\r\nValue: [ metric='A-series' labels={} value=66.70686542247081 ]\r\nLabels:\r\n- alertname = Panel Title alert\r\n- rule_uid = wZxhr8qnk\r\n- sns_issue_avg = 182\r\nAnnotations:\r\n- message = Whoa, a text box!\r\nSource: https://localhost/alerting/wZxhr8qnk/edit\r\nSilence: https://localhost/alerting/silence/new?alertmanager=grafana&matcher=alertname%3DPanel+Title+alert&matcher=rule_uid%3DwZxhr8qnk&matcher=sns_issue_avg%3D182\r\nDashboard: https://localhost/d/8pzOgDYnz\r\nPanel: https://localhost/d/8pzOgDYnz?viewPanel=2\r\n\r\nValue: [no value]\r\nLabels:\r\n- alertname = Panel Two alert\r\n- magicalNumbers = 31238\r\n- rule_uid = 3Wbh9Uqnk\r\n- severity = low\r\nAnnotations:\r\n- message = Look an alert message body!\r\nSource: https://localhost/alerting/3Wbh9Uqnk/edit\r\nSilence: https://localhost/alerting/silence/new?alertmanager=grafana&matcher=alertname%3DPanel+Two+alert&matcher=magicalNumbers%3D31238&matcher=rule_uid%3D3Wbh9Uqnk&matcher=severity%3Dlow\r\nDashboard: https://localhost/d/8pzOgDYnz\r\nPanel: https://localhost/d/8pzOgDYnz?viewPanel=4\r\n\r\nBody: 0 firing. 2 resolved. Body!\r\n```\r\n\r\n**Example for the _JSON_ format**\r\n```\r\n{\r\n\t\"receiver\": \"Templating_Test\",\r\n\t\"status\": \"firing\",\r\n\t\"alerts\": [\r\n\t\t{\r\n\t\t\t\"status\": \"firing\",\r\n\t\t\t\"labels\": {\r\n\t\t\t\t\"alertname\": \"Panel Two alert\",\r\n\t\t\t\t\"magicalNumbers\": \"31238\",\r\n\t\t\t\t\"rule_uid\": \"3Wbh9Uqnk\",\r\n\t\t\t\t\"severity\": \"low\"\r\n\t\t\t},\r\n\t\t\t\"annotations\": {\r\n\t\t\t\t\"message\": \"Look an alert message body!\"\r\n\t\t\t},\r\n\t\t\t\"startsAt\": \"2022-06-28T15:25:08.440536-07:00\",\r\n\t\t\t\"endsAt\": \"0001-01-01T00:00:00Z\",\r\n\t\t\t\"generatorURL\": \"https://localhost/alerting/3Wbh9Uqnk/edit\",\r\n\t\t\t\"fingerprint\": \"fdb2c62c79358fe9\",\r\n\t\t\t\"silenceURL\": \"https://localhost/alerting/silence/new?alertmanager=grafana\\u0026matcher=alertname%3DPanel+Two+alert\\u0026matcher=magicalNumbers%3D31238\\u0026matcher=rule_uid%3D3Wbh9Uqnk\\u0026matcher=severity%3Dlow\",\r\n\t\t\t\"dashboardURL\": \"https://localhost/d/8pzOgDYnz\",\r\n\t\t\t\"panelURL\": \"https://localhost/d/8pzOgDYnz?viewPanel=4\",\r\n\t\t\t\"valueString\": \"[ metric='A-series' labels={} value=2 ]\"\r\n\t\t}\r\n\t],\r\n\t\"groupLabels\": {},\r\n\t\"commonLabels\": {\r\n\t\t\"alertname\": \"Panel Two alert\",\r\n\t\t\"magicalNumbers\": \"31238\",\r\n\t\t\"rule_uid\": \"3Wbh9Uqnk\",\r\n\t\t\"severity\": \"low\"\r\n\t},\r\n\t\"commonAnnotations\": {\r\n\t\t\"message\": \"Look an alert message body!\"\r\n\t},\r\n\t\"externalURL\": \"https://localhost/\",\r\n\t\"body\": \"1 firing. 0 resolved. Body!\"\r\n}\r\n```\r\n\r\n**Example for the _Body Text only_ format**\r\n```\r\n0 firing. 1 resolved. Body!\r\n```\r\n\r\n## Templating Support\r\nGrafana Unified Alerting has introduced message templating. This functionality is supported by the unified alerting SNS Grafana notifier. [[Grafana Docs](https://grafana.com/docs/grafana/latest/alerting/contact-points/message-templating/)]\r\n\r\n### Example\r\nA template is specified as the subject of the email:\r\n![Screen Shot 2022-06-28 at 2 51 11 PM](https://user-images.githubusercontent.com/31365193/176323854-06026c0e-a315-42d8-b3f9-b55f4615bedc.png)\r\n\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/grafana/grafana/issues/51724/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/grafana/grafana/issues/51724/timeline", "performed_via_github_app": null, "state_reason": null}]